# Lab 03 - Examine IPv6 and BGP Settings

## Goals

Understand the network and BGP routing configuration.

## Prerequisites

* Access to the running host instances

## Log into a Web Server via SSH

From the lab master, log into the deployed host instances using the installed SSH key. As part of the lab deployment, al the deployed hosts were embedded with an SSH key (my_key). The full SSH command is listed as "SSH Access Server 0" when `terraform output` is run.


```
terraform output
ssh root@<Server IP v4> -i my_key
```
## Examine the v6 Addressing

On the deployed host, display and examine the IPv6 addresses assigned to the host. 

```
ip -6 a show
```

Sample output (your IPv6 addresses will differ):
```
root@bgp01-ewr1-00:~# ip -6 a show
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 state UNKNOWN qlen 1000
    inet6 2604:1380:2:2301::1/64 scope global deprecated
       valid_lft forever preferred_lft 0sec
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
4: bond0: <BROADCAST,MULTICAST,MASTER,UP,LOWER_UP> mtu 1500 state UP qlen 1000
    inet6 2604:1380:2:2300::3/127 scope global
       valid_lft forever preferred_lft forever
    inet6 fe80::ec4:7aff:fee5:484c/64 scope link
       valid_lft forever preferred_lft forever
```

Take note of the ::1/64 address on the lo interface. That same address has been assigned to all the hosts in the cluster and communicated to the upstream router via BGP. It's the address used for the anycast failover.

The subnet assigned, :2301:, is assigned to this lab. The whole space 2604:1380:2:2301::/64 is available for your use as you wish. Only the ::1 address has been used so far.

The IPv6 address to the bond0 interface is a point to point link assigned to the host when it boots.

## Examine Network Interface File

These network settings are defined in the network interfaces file. We'll take a look later how this file is automatically generated. For now, take a look at the format and the values set within. Take a look at the last few lines where the anycast ipv6 address is assigned to lo:0.

```
more /etc/network/interfaces
```


## Examine BGP Data

Next we're going to examine the running BGP routing details using BIRD, an open source, software router.

Let's see what routing protocols are running. (Make sure to add the 6 to run the IPv6 version of birdc.)
```
birdc6 show protocols
```
You'll see that BGP is running.

Now examine the full BGP routing details.
```
birdc6 show protocols all bgp1
```

Sample output:
```
root@bgp03-ewr1-00:~# birdc6 show protocols all bgp1
BIRD 1.6.3 ready.
name     proto    table    state  since       info
bgp1     BGP      master   up     17:49:21    Established
  Preference:     100
  Input filter:   ACCEPT
  Output filter:  metal_bgp
  Routes:         0 imported, 1 exported, 0 preferred
  Route change stats:     received   rejected   filtered    ignored   accepted
    Import updates:              0          0          0          0          0
    Import withdraws:            0          0        ---          0          0
    Export updates:              1          0          0        ---          1
    Export withdraws:            0        ---        ---        ---          0
  BGP state:          Established
    Neighbor address: 2604:1380:2:2300::6
    Neighbor AS:      65530
    Neighbor ID:      147.75.36.66
    Neighbor caps:    refresh restart-aware AS4
    Session:          external AS4
    Source address:   2604:1380:2:2300::7
    Hold timer:       84/90
    Keepalive timer:  11/30
```

## Examine BIRD Configuration file

The BIRD software processes using a configuration file that details what routing protocols to run (BGP in our case)
```
more /etc/bird/bird6.conf
```

Take note of the "filter metal_bgp" and the network that is being communicated via BGP to the neighbor router. As you can see, this is the /64 that has been assigned to this lab.

## Next Steps

Once you've verified the BGP information proceed to [Lab 4](Lab04.md)
